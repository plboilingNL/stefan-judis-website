<template>
  <div>
    <div class="nuxt-progress" :style="{
      'width': percent+'%',
      'opacity': show ? 1 : 0
    }"></div>
    <div class="c-logo">
      <nuxt-link :to="'/'" aria-label="Home" :class="[loading ? 'is-loading': '']">
        <svg width="100" height="57" viewBox="0 0 659 377" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><linearGradient x1="0%" y1="5.31%" x2="97.614%" y2="92.745%" id="c"><stop stop-color="#1A79B8" offset="0%"/><stop stop-color="#4AA9E8" offset="100%"/></linearGradient><path d="M363.742 337.679l96.343-96.342.067-.068 32.106-32.106.385-.384a95.853 95.853 0 0 0 6.305-6.961 83.704 83.704 0 0 0 4.012-5.244 85.962 85.962 0 0 0 3.458-5.176 90.121 90.121 0 0 0 3.232-5.616 91.817 91.817 0 0 0 3.402-7.131c.215-.486.418-.972.621-1.458a96.19 96.19 0 0 0 6.035-21.517c.26-1.638.475-3.277.655-4.916.238-2.135.396-4.272.475-6.407.068-1.391.101-2.78.101-4.17a98.028 98.028 0 0 0-.688-11.561 86.538 86.538 0 0 0-.78-5.345 96.512 96.512 0 0 0-1.831-8.363 98.338 98.338 0 0 0-1.401-4.723 95.385 95.385 0 0 0-2.566-7.03c-.056-.135-.113-.282-.181-.418a86.842 86.842 0 0 0-1.876-4.238 83.387 83.387 0 0 0-1.966-3.921 82.28 82.28 0 0 0-1.537-2.78 109.965 109.965 0 0 0-2.294-3.82c-.917-1.421-1.87-2.82-2.859-4.192-.43-.611-.87-1.221-1.322-1.82a77.778 77.778 0 0 0-2.69-3.424 89.927 89.927 0 0 0-4.803-5.413c-.486-.52-.995-1.04-1.502-1.548-.125-.125-.25-.249-.385-.373-.384-.384-.78-.757-1.163-1.13a77.48 77.48 0 0 0-2.849-2.611 91.145 91.145 0 0 0-2.554-2.192 87.24 87.24 0 0 0-3.424-2.69c-.237-.181-.474-.35-.711-.531a99.381 99.381 0 0 0-4.012-2.791c-.442-.294-.87-.577-1.312-.848a88.132 88.132 0 0 0-3.807-2.305c-.521-.294-1.052-.588-1.572-.87a79.533 79.533 0 0 0-5.13-2.622 88.47 88.47 0 0 0-4.238-1.888c-.441-.18-.882-.361-1.334-.542a108.64 108.64 0 0 0-4.011-1.503 72.867 72.867 0 0 0-2.102-.7 108.7 108.7 0 0 0-4.588-1.357c-.046-.011-.101-.022-.147-.034a79.566 79.566 0 0 0-3.876-.949 87.015 87.015 0 0 0-4.476-.893c-.734-.124-1.469-.237-2.203-.35a71.23 71.23 0 0 0-3.142-.429l-.881-.102a88.131 88.131 0 0 0-6.69-.497 55.58 55.58 0 0 0-1.955-.068c-.689-.011-1.368-.022-2.057-.022a92.464 92.464 0 0 0-6.69.237c-1.34.082-2.678.2-4.012.35-1.6.174-3.193.392-4.78.655-.633.091-1.277.204-1.91.328a69.927 69.927 0 0 0-4.012.803c-.576.124-1.152.259-1.729.395-1.665.409-3.32.86-4.961 1.356a88.14 88.14 0 0 0-4.012 1.288 94.98 94.98 0 0 0-6.34 2.475c-.113.046-.237.102-.35.147a99.225 99.225 0 0 0-4.012 1.842 96.07 96.07 0 0 0-6.69 3.617 54.31 54.31 0 0 0-1.707 1.039 74.66 74.66 0 0 0-2.316 1.48 91.622 91.622 0 0 0-6.69 4.849 80.164 80.164 0 0 0-4.012 3.368 90.957 90.957 0 0 0-4.339 4.068l-13.053 13.052-4.012 4.023-9.098 9.097-26.172-26.172c-18.86-18.861-43.734-28.309-68.607-28.309-24.861 0-49.724 9.448-68.596 28.309-37.722 37.722-37.722 99.447 0 137.192l32.581 32.576-.001.004 94.575 94.554.023.023 7.347 7.346.434.43a96.953 96.953 0 0 0 5.02 4.621l24.342 23.575 33.497-34.23v.001zm290.829-166.913v31.11c-9.799.255-17.78 2.927-23.952 8.015-6.172 5.092-10.276 11.994-12.309 20.709-2.038 8.718-3.12 23.698-3.246 44.947-.128 21.248-.51 35.244-1.144 41.989-1.145 10.813-3.277 19.436-6.395 25.862-3.119 6.423-6.965 11.575-11.546 15.46-4.582 3.879-10.436 6.837-17.558 8.874-4.838 1.399-12.726 2.099-23.667 2.099h-10.691v-29.964h5.918c13.234 0 22.012-2.387 26.339-7.156 4.324-4.774 6.489-15.495 6.489-32.161 0-31.808.573-51.977 1.717-60.504 2.034-14.122 6.109-25.412 12.215-33.876 6.109-8.46 14.759-15.045 25.957-19.755-14.633-6.995-24.94-16.251-30.918-27.769-5.982-11.515-8.971-30.949-8.971-58.307 0-24.812-.318-39.633-.955-44.471-.89-8.524-3.404-14.472-7.538-17.846-4.136-3.369-12.249-5.056-24.335-5.056h-5.918V3h10.691c12.469 0 21.501 1.021 27.1 3.054 8.142 2.8 14.887 7.51 20.231 14.124 5.347 6.617 8.809 14.951 10.402 25.003 1.59 10.053 2.449 26.528 2.577 49.432.126 22.902 1.208 38.715 3.246 47.428 2.033 8.717 6.137 15.62 12.309 20.707 6.172 5.092 14.153 7.764 23.952 8.018zm-626.618-8.018c6.171-5.087 10.276-11.99 12.309-20.707 2.038-8.713 3.12-24.526 3.246-47.428.128-22.904.987-39.379 2.577-49.432 1.592-10.052 5.056-18.386 10.402-25.003 5.344-6.614 12.089-11.324 20.23-14.124C82.317 4.021 91.35 3 103.818 3h10.69v29.966h-5.917c-12.087 0-20.199 1.687-24.335 5.056-4.134 3.374-6.648 9.322-7.539 17.846-.636 4.838-.953 19.659-.953 44.471 0 27.358-2.989 46.792-8.972 58.307-5.978 11.518-16.285 20.774-30.918 27.769 11.198 4.71 19.848 11.295 25.957 19.755 6.106 8.464 10.181 19.754 12.214 33.876 1.145 8.527 1.719 28.696 1.719 60.504 0 16.666 2.163 27.387 6.488 32.161 4.328 4.769 13.105 7.156 26.339 7.156h5.917v29.964h-10.69c-10.941 0-18.829-.7-23.666-2.099-7.123-2.037-12.977-4.995-17.559-8.874-4.581-3.885-8.427-9.037-11.547-15.46-3.117-6.426-5.249-15.049-6.394-25.862-.634-6.745-1.016-20.741-1.144-41.989-.126-21.249-1.208-36.229-3.246-44.947-2.033-8.715-6.138-15.617-12.309-20.709-6.171-5.088-14.153-7.76-23.953-8.015v-31.11c9.8-.254 17.782-2.926 23.953-8.018z" id="b"/><filter x="-1%" y="-1.5%" width="102%" height="103.5%" filterUnits="objectBoundingBox" id="a"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetOuter1"/><feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"/><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0" in="shadowBlurOuter1"/></filter></defs><g fill-rule="nonzero" fill="none"><use fill="#000" filter="url(#a)" xlink:href="#b"/><use fill="url(#c)" fill-rule="evenodd" xlink:href="#b"/></g></svg>
      </nuxt-link>
    </div>
  </div>
</template>

<script>
import Vue from 'vue';
export default {
  name: 'nuxt-loading',
  data() {
    return {
      percent: 0,
      show: false,
      loading: false,
      canSuccess: true,
      duration: 500
    };
  },
  methods: {
    start() {
      this.show = true;
      this.loading = true;
      this.canSuccess = true;
      if (this._timer) {
        clearInterval(this._timer);
        this.percent = 0;
      }
      this._cut = 10000 / Math.floor(this.duration);
      this._timer = setInterval(() => {
        this.increase(this._cut * Math.random());
        if (this.percent > 95) {
          this.finish();
        }
      }, 100);
      return this;
    },
    set(num) {
      this.show = true;
      this.canSuccess = true;
      this.percent = Math.floor(num);
      return this;
    },
    get() {
      return Math.floor(this.percent);
    },
    increase(num) {
      this.percent = this.percent + Math.floor(num);
      return this;
    },
    decrease(num) {
      this.percent = this.percent - Math.floor(num);
      return this;
    },
    finish() {
      this.percent = 100;
      this.hide();
      setTimeout(_ => {
        this.loading = false;
      }, 500);
      return this;
    },
    pause() {
      clearInterval(this._timer);
      return this;
    },
    hide() {
      clearInterval(this._timer);
      this._timer = null;
      setTimeout(() => {
        this.show = false;
        Vue.nextTick(() => {
          setTimeout(() => {
            this.percent = 0;
          }, 200);
        });
      }, 500);
      return this;
    },
    fail() {
      this.canSuccess = false;
      return this;
    }
  }
};
</script>

<style>
.nuxt-progress {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  width: 0%;
  transition: width 0.2s, opacity 0.4s;
  opacity: 1;
  background-color: #1a79b8;
  z-index: 999999;
}

.c-logo {
  --logo-size: 3em;

  height: var(--logo-size);
  margin: 2em auto 0;

  a {
    display: block;
    text-align: center;
    height: 100%;
  }

  svg {
    height: 100%;
  }
}

@media (min-width: 47em) {
  .c-logo {
    --logo-size: 1.5em;

    position: fixed;
    z-index: 3;
    left: 0;
    top: 1em;
    margin: 0;
  }
}
</style>
